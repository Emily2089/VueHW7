import{m as k,P as L,A}from"./AdminDelModal-CfsCCkbR.js";import{_ as g,o as i,c as a,a as e,f as p,i as r,j as w,m as V,r as u,b as _,F as D,e as T,t as m}from"./index-DAU5l-VP.js";import{M as E,m as I}from"./MessageToast-CAALy9c9.js";import"./bootstrap.esm-Ceob_0pG.js";const U={props:{tempCoupon:Object,is_new:Boolean},data(){return{editCoupon:{},due_date:""}},emits:["update-coupon"],mixins:[k],watch:{tempCoupon(){this.editCoupon=this.tempCoupon;const o=new Date(this.editCoupon.due_date*1e3).toISOString().split("T")[0];this.due_date=o},due_date(){this.editCoupon.due_date=new Date(this.due_date)/1e3}},mounted(){this.editCoupon=this.tempCoupon}},P={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"couponModalLabel","aria-hidden":"true",ref:"modal"},S={class:"modal-dialog",role:"document"},j={class:"modal-content border-0"},B={class:"modal-header bg-dark text-white"},R={class:"modal-title",id:"couponModalLabel"},N={key:0},O={key:1},F=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),H={class:"modal-body"},W={class:"mb-3"},q=e("label",{for:"title"},"標題",-1),z={class:"mb-3"},G=e("label",{for:"coupon_code"},"優惠碼",-1),J={class:"mb-3"},K=e("label",{for:"due_date"},"到期日",-1),Q={class:"mb-3"},X=e("label",{for:"price"},"折扣百分比",-1),Y={class:"mb-3"},Z={class:"form-check"},ee=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),te={class:"modal-footer"},oe=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1),se={type:"button",class:"btn btn-primary"};function ne(o,t,d,C,s,c){return i(),a("div",P,[e("div",S,[e("div",j,[e("div",B,[e("h5",R,[d.is_new?(i(),a("span",N,"新增優惠券")):(i(),a("span",O,"編輯優惠券"))]),F]),e("div",H,[e("div",W,[q,p(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=n=>s.editCoupon.title=n),placeholder:"請輸入標題"},null,512),[[r,s.editCoupon.title]])]),e("div",z,[G,p(e("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[1]||(t[1]=n=>s.editCoupon.code=n),placeholder:"請輸入優惠碼"},null,512),[[r,s.editCoupon.code]])]),e("div",J,[K,p(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=n=>this.due_date=n)},null,512),[[r,this.due_date]])]),e("div",Q,[X,p(e("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":t[3]||(t[3]=n=>s.editCoupon.percent=n),placeholder:"請輸入折扣百分比 Ex.85折>85"},null,512),[[r,s.editCoupon.percent]])]),e("div",Y,[e("div",Z,[p(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=n=>s.editCoupon.is_enabled=n),id:"is_enabled"},null,512),[[w,s.editCoupon.is_enabled]]),ee])])]),e("div",te,[oe,e("button",se,[d.is_new?(i(),a("span",{key:0,onClick:t[5]||(t[5]=n=>o.$emit("update-coupon",d.tempCoupon))},"新增優惠券")):(i(),a("span",{key:1,onClick:t[6]||(t[6]=n=>o.$emit("update-coupon",d.tempCoupon))},"更新優惠券"))])])])])],512)}const ie=g(U,[["render",ne]]);var ae={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_NAME:"emily-apitest",BASE_URL:"/VueHW7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:h,VITE_API_NAME:b}=ae,de={data(){return{coupons:[],tempCoupon:{title:"",code:"",due_date:"",percent:"",is_enabled:0},is_new:!0,pages:{},obj:"coupon",isLoading:!1}},components:{PaginationComponent:L,MessageToast:E,AdminCouponModal:ie,AdminDelModal:A},methods:{...V(I,["pushMessage"]),getCoupons(o=1){this.isLoading=!0,this.axios.get(`${h}/api/${b}/admin/coupons?page=${o}`).then(t=>{this.coupons=t.data.coupons,this.pages=t.data.pagination,this.isLoading=!1,this.pushMessage({style:"success",title:"成功取得優惠券資訊",content:t.data.message})}).catch(t=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"取得優惠券資訊失敗",content:t.response.data.message})})},openModal(o,t){o==="新增"?(this.$refs.cModal.openModal(),this.is_new=!0,this.tempCoupon={due_date:new Date().getTime()/1e3}):o==="編輯"?(this.$refs.cModal.openModal(),this.is_new=!1,this.tempCoupon={...t}):o==="刪除"&&(this.$refs.dModal.openModal(),this.tempCoupon={...t})},updateCoupon(){this.isLoading=!0;let o=`${h}/api/${b}/admin/coupon`,t="post";this.is_new===!1&&(o=`${h}/api/${b}/admin/coupon/${this.tempCoupon.id}`,t="put"),this.axios[t](o,{data:this.tempCoupon}).then(d=>{this.isLoading=!1,this.pushMessage({style:"success",title:"成功更新優惠券資訊",content:d.data.message}),this.$refs.cModal.closeModal(),this.getCoupons()}).catch(d=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"更新優惠券資訊失敗",content:d.response.data.message})})},deleteCoupon(){this.isLoading=!0,this.axios.delete(`${h}/api/${b}/admin/coupon/${this.tempCoupon.id}`).then(o=>{this.isLoading=!1,this.pushMessage({style:"success",title:"成功刪除優惠券資訊",content:o.data.message}),this.$refs.dModal.closeModal(),this.getCoupons()}).catch(o=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"刪除優惠券資訊失敗",content:o.response.data.message})})}},mounted(){this.getCoupons()}},le={class:"text-end mt-4"},ce={class:"table mt-4 align-middle"},pe=e("thead",null,[e("tr",null,[e("th",{class:"text-top"},"名稱"),e("th",{class:"text-center"},"優惠碼"),e("th",{class:"text-center"},"折扣百分比"),e("th",{class:"text-center"},"到期日"),e("th",{class:"text-center"},"是否啟用"),e("th",{class:"text-center"},"編輯")])],-1),ue={class:"text-top"},_e={class:"text-center"},re={class:"text-center"},me={class:"text-center"},he={class:"text-center"},be={key:0,class:"text-success"},ge={key:1},Ce={class:"text-center"},fe={class:"btn-group"},Me=["onClick"],ye=["onClick"];function ve(o,t,d,C,s,c){const n=u("VueLoading"),f=u("MessageToast"),M=u("PaginationComponent"),y=u("AdminCouponModal"),v=u("AdminDelModal");return i(),a("div",null,[_(n,{active:s.isLoading},null,8,["active"]),_(f),e("div",le,[e("button",{class:"btn btn-primary",type:"button",onClick:t[0]||(t[0]=l=>c.openModal("新增"))}," 建立新的優惠券 ")]),e("table",ce,[pe,e("tbody",null,[(i(!0),a(D,null,T(s.coupons,(l,x)=>(i(),a("tr",{key:"coupon"+x},[e("td",ue,m(l.title),1),e("td",_e,m(l.code),1),e("td",re,m(l.percent)+"%",1),e("td",me,m(o.$filters.AccurateDate(l.due_date)),1),e("td",he,[l.is_enabled?(i(),a("span",be,"啟用")):(i(),a("span",ge))]),e("td",Ce,[e("div",fe,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:$=>c.openModal("編輯",l)},"編輯",8,Me),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:$=>c.openModal("刪除",l)},"刪除",8,ye)])])]))),128))])]),_(M,{pages:s.pages,"get-data":c.getCoupons},null,8,["pages","get-data"]),_(y,{ref:"cModal","temp-coupon":s.tempCoupon,is_new:s.is_new,onUpdateCoupon:c.updateCoupon},null,8,["temp-coupon","is_new","onUpdateCoupon"]),_(v,{ref:"dModal",obj:s.obj,item:s.tempCoupon,onDeleteItem:c.deleteCoupon},null,8,["obj","item","onDeleteItem"])])}const Ae=g(de,[["render",ve]]);export{Ae as default};
